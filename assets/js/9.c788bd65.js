(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{367:function(t,e,s){"use strict";s.r(e);var a=s(44),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"starting-point"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#starting-point"}},[t._v("#")]),t._v(" Starting point")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("PlaShiki is reaching its EOL on August 15th, 2021,\nand then every request will result in "),s("code",[t._v("EOL_REACHED")]),t._v(" error.")]),t._v(" "),s("p",[t._v("Please migrate your apps to other APIs.")])]),t._v(" "),s("p",[t._v("Welcome to PlaShiki documentation!")]),t._v(" "),s("p",[t._v("We at PlaShiki ‚ù§Ô∏è FOSS, so our entire stack is available under GPLv3/AGPLv3.\n"),s("a",{attrs:{href:"https://github.com/plashiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("Check it out!"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("We are also proud to provide simple yet reliable REST-like API. Let's jump into it!")]),t._v(" "),s("h2",{attrs:{id:"general"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#general"}},[t._v("#")]),t._v(" General")]),t._v(" "),s("p",[t._v("Our API server is available at "),s("code",[t._v("https://plashiki.su/api")]),t._v(". There's no\nglobal rate limit, but please don't flood our server to death üòÉ")]),t._v(" "),s("h2",{attrs:{id:"envelope"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envelope"}},[t._v("#")]),t._v(" Envelope")]),t._v(" "),s("p",[t._v("All API methods (except ones with "),s("em",[t._v("Raw (HTML) response")]),t._v(" which are marked explicitly)\nare consistent with their response envelope, which encloses the response. Here it is:")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Envelope")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Whether the request was successful\n     */")]),t._v("\n    ok"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Request result. Present when `ok` is true.\n     */")]),t._v("\n    result"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Request failure reason (error code). Present when `ok` is false.\n     */")]),t._v("\n    reason"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Request failure reason description. Present sometimes when `ok` is false.\n     */")]),t._v("\n    description"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Time it took for the server to process the request (in ms)\n     */")]),t._v("\n    serve_time"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("For example:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ok"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"serve_time"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.2312")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("And another example with error:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ok"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ACCESS_DENIED"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"serve_time"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.7819")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("All API methods return "),s("code",[t._v("200 OK")]),t._v(" even if an error has occurred.")]),t._v(" "),s("h2",{attrs:{id:"errors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#errors"}},[t._v("#")]),t._v(" Errors")]),t._v(" "),s("p",[t._v("Most errors follow the "),s("strong",[t._v("CAPS_SNAKE")]),t._v(" naming convention, the ones that do not\nare from older 1.x/2.x times.")]),t._v(" "),s("p",[t._v("Generally, each endpoint has its own set of errors that may happen during execution.\nHowever, there's a bunch of errors that happen to be common for all the endpoints.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("div",{staticStyle:{"min-width":"160px"}},[t._v("Error")])]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("Internal Error")])]),t._v(" "),s("td",[t._v("Unknown internal server error happened.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Invalid syntax")])]),t._v(" "),s("td",[t._v("Your client issued an invalid request (probably malformed JSON body)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Malformed request")])]),t._v(" "),s("td",[t._v("Request contained an unprocessable entity.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Unknown method")])]),t._v(" "),s("td",[t._v("Exactly as it sounds - unknown method (or invalid HTTP method for a valid one, i.e. "),s("code",[t._v("GET")]),t._v(" instead of "),s("code",[t._v("POST")]),t._v(")")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Too many requests")])]),t._v(" "),s("td",[t._v("Rate limit reached.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("CAPTCHA")])]),t._v(" "),s("td",[t._v("Captcha required. Captcha is only used in our internal endpoints (that fact is marked in the description)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("VALIDATION_ERROR")])]),t._v(" "),s("td",[t._v("Validation failed. Check the "),s("code",[t._v("description")]),t._v(" field to find out what's wrong.")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("INVALID_TOKEN")])]),t._v(" "),s("td",[t._v("Authorization token passed is invalid. Like, generally invalid, we didn't even lookup a session")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("INVALID_SESSION")])]),t._v(" "),s("td",[t._v("Authorization token was valid... at some time. No longer, probably because user revoked it")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("UNKNOWN_USER")])]),t._v(" "),s("td",[t._v("Your session is valid, but it is linked to a non-existent user. Should not occur in normal circumstances, so treat it as Internal Error")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("UNKNOWN_FIELD")])]),t._v(" "),s("td",[t._v("One of fields passed in "),s("code",[t._v("sort")]),t._v(" parameter does not exist on related entity or is not sortable (like "),s("code",[t._v("json")]),t._v(" or arrays)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("EOL_REACHED")])]),t._v(" "),s("td",[t._v("This method is no longer available due to EOL.")])])])]),t._v(" "),s("h2",{attrs:{id:"pagination-sorting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pagination-sorting"}},[t._v("#")]),t._v(" Pagination & sorting")]),t._v(" "),s("p",[t._v("Some endpoints enforce pagination. Each of them support a pair of "),s("code",[t._v("?limit")]),t._v(" and "),s("code",[t._v("?offset")]),t._v("\nquery parameters to paginate over the set. Most endpoints have a maximum limit, usually\naround 50 items.")]),t._v(" "),s("p",[t._v("Some endpoints additionally support sorting using "),s("code",[t._v("?sort")]),t._v(" parameter. It is quite flexible\nand can be used to sort by multiple fields, both ways, by putting multiple fields with comma."),s("br"),t._v("\nFor example: "),s("code",[t._v("?sort=id,-updated_at,nickname")]),t._v(" will produce the following SQL:\n"),s("code",[t._v("order by id, updated_at desc, nickname")]),t._v(". So, by prepending "),s("code",[t._v("-")]),t._v(" it sorts in reverse order.")]),t._v(" "),s("p",[t._v("When scrolling through documentation, you may notice\n"),s("code",[t._v("PaginatedResponse<T>")]),t._v(", which is used to wrap paginated resources like this:")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PaginatedResponse")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n    items"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"authorization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authorization"}},[t._v("#")]),t._v(" Authorization")]),t._v(" "),s("p",[t._v("No authorization is needed for our mostly used endpoints. It is only needed for\nendpoints that actually update data (so we know who has done that).")]),t._v(" "),s("p",[t._v("Strictly speaking, we have 2 authorization flows. However, one of them is needed for the\nother one to work, so we'll not cover it üòú. Soo, introducing PlaShiki OAuth!")]),t._v(" "),s("p",[t._v("In fact, what we have is nowhere near like the standard OAuth. Mainly because it is\noverly complicated for our scale. We know about all the security flaws,\nbut anyway since our flow is very similar to OAuth, we'll call it OAuth.")]),t._v(" "),s("h3",{attrs:{id:"creating-an-app"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creating-an-app"}},[t._v("#")]),t._v(" Creating an app")]),t._v(" "),s("p",[t._v("To use OAuth, first of all you'll need to "),s("a",{attrs:{href:"https://plashiki.su/apps",target:"_blank",rel:"noopener noreferrer"}},[t._v("register an app here"),s("OutboundLink")],1),t._v(".\nThere you'll receive your "),s("code",[t._v("client_id")]),t._v(" and "),s("code",[t._v("client_secret")]),t._v(". Client Secret is only used\nfor server-to-server actions (and is not needed when authorizing).")]),t._v(" "),s("p",[t._v("Also, you may want to setup a "),s("code",[t._v("redirect_uri")]),t._v(". By default it will be\n"),s("a",{attrs:{href:"https://plashiki.su/static/oauth.blank.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://plashiki.su/static/oauth.blank.html"),s("OutboundLink")],1),t._v(",\nand if you are building a standalone app, there's no need in setting up one.")]),t._v(" "),s("p",[t._v("That's pretty much it. You may also want to set up an image for your app, but it's optional")]),t._v(" "),s("h3",{attrs:{id:"implicit-flow"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implicit-flow"}},[t._v("#")]),t._v(" Implicit Flow")]),t._v(" "),s("p",[t._v("Again, what we have is nowhere near like the standard, but quite similar.")]),t._v(" "),s("p",[t._v("To request a token, you'll need to open a browser page:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://plashiki.su/api/v2/oauth/authorize?client_id=YOUR_CLIENT_ID\n")])])]),s("p",[t._v("Then, once a user has clicked one of the buttons, it will be redirected either to")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("REDIRECT_URI?ok=0\n")])])]),s("p",[t._v("in case user declined the request, and")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("REDIRECT_URI?ok=1&token=TOKEN\n")])])]),s("p",[t._v("in case user accepted the request. Here, the "),s("code",[t._v("TOKEN")]),t._v(" is the token you'll\nwant to store safely and use it in further requests like this:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Authorization: Bearer TOKEN\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[s("code",[t._v("TOKEN")]),t._v(" in URL may have URL-encoded entities (like "),s("code",[t._v("%3D")]),t._v("), so you should url-decode it.")])]),t._v(" "),s("h2",{attrs:{id:"websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" WebSocket")]),t._v(" "),s("p",[t._v("To deliver real-time stuff like notifications we use a WebSocket.\nIt is available at "),s("code",[t._v("/api/ws")]),t._v(".")]),t._v(" "),s("p",[t._v("You can pass your "),s("code",[t._v("Authorization")]),t._v(" header as normal - no need in additional authorization\ninside a WebSocket, server will recognize you. However, in case of bad token you'll end up\nwith a plain HTTP response ("),s("code",[t._v("200 OK")]),t._v(" but with error inside) instead\nof "),s("code",[t._v("101 Switching Protocols")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"keepalive"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#keepalive"}},[t._v("#")]),t._v(" KeepAlive")]),t._v(" "),s("p",[t._v("Since we use CloudFlare for proxying, it has a limit of 100 seconds for a WebSocket to idle.\nThis way, you have two options: send keep-alive packets or reconnect every time.")]),t._v(" "),s("p",[t._v("To keep things simple‚Ñ¢ and to reduce bandwidth, a keep-alive message is\nnothing more than a message containing "),s("code",[t._v("KA")]),t._v(". That's it, just "),s("code",[t._v("KA")]),t._v(".\nIn response, server will send "),s("code",[t._v("KAACK")]),t._v(" (keep-alive acknowledgement).")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("KAACK")]),t._v(" is sent as a plain-text, and only sent in response to "),s("code",[t._v("KA")]),t._v(". So, if you don't send\n"),s("code",[t._v("KA")]),t._v(" packets, you don't need to handle "),s("code",[t._v("KAACK")]),t._v(".")])]),t._v(" "),s("h3",{attrs:{id:"notifications"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#notifications"}},[t._v("#")]),t._v(" Notifications")]),t._v(" "),s("p",[t._v("Once connected, your client may just idle - it will receive notifications in no time.\nA notification will be sent like this:")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InNotification")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Type of action -- push notification\n     */")]),t._v("\n    act"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'push'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Notification ID (or IDs)\n     */")]),t._v("\n    id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Action type: C - create, U - update, D - delete\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'C'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'U'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'D'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * List of topics of the notification\n     */")]),t._v("\n    topics"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Progress of the notification\n     */")]),t._v("\n    progress"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Payload of the notification\n     */")]),t._v("\n    data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("As you may notice, many fields are similar to "),s("RouterLink",{attrs:{to:"/entities/#entity-notification"}},[t._v("Notification")]),t._v(",\nbut with shorter names to reduce bandwidth. However, in case you want to handle incoming\nnotifications, you should be aware of all the payload types. You can find them in\nfrontend source code:\n"),s("a",{attrs:{href:"https://github.com/plashiki/plashiki-frontend/tree/master/src/types/notification.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1)],1),t._v(" "),s("h3",{attrs:{id:"api-over-websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-over-websocket"}},[t._v("#")]),t._v(" API-over-WebSocket")]),t._v(" "),s("p",[t._v("Your may want use the asynchronous nature of WebSockets to send API requests.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("API-over-WebSocket is currently experimental and may be more error-prone,\nworse at handling concurrency and slower in general.")]),t._v(" "),s("p",[t._v("Use at own risk!")])]),t._v(" "),s("p",[t._v("The interface is very simple:")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiOverWebsocket")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Describes the action - api request\n     */")]),t._v("\n    act"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'api'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Optionally - request ID. Client should keep track of them on their own.\n     * Will be returned with the response to map with the request\n     */")]),t._v("\n    id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * HTTP method. Defaults to GET\n     */")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PATCH'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Endpoint path. Should not include the base url, nor query string.\n     */")]),t._v("\n    path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Query params\n     */")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" object\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Request body\n     */")]),t._v("\n    body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" object "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("So basically everything you'd generally put in your abstract API function is here.")]),t._v(" "),s("p",[t._v("Once sent, after a while the server will respond with an envelope very similar\nto the one seen before, but with additional "),s("code",[t._v("id")]),t._v(" field to map with original request.")]),t._v(" "),s("h2",{attrs:{id:"internationalization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#internationalization"}},[t._v("#")]),t._v(" Internationalization")]),t._v(" "),s("p",[t._v("PlaShiki tries to be as open as possible, so if you can't\nfind your language, PRs are welcome üòÉ"),s("br"),t._v("\nCurrently we support these locales:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("en")]),t._v(" for English (default)")]),t._v(" "),s("li",[s("code",[t._v("ru")]),t._v(" for Russian")])]),t._v(" "),s("h2",{attrs:{id:"protected-resources"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#protected-resources"}},[t._v("#")]),t._v(" Protected resources")]),t._v(" "),s("p",[t._v("To keep our project up and running, we have a bunch of protected internal\nresources. To access them, we use the same OAuth apps API, but in a slightly\ndifferent way."),s("br"),t._v("\nRemember "),s("code",[t._v("client_secret")]),t._v("? You can actually use it to communicate with\nour server from your server and do some stuff! To authorize you should use:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Authorization: Token CLIENT_SECRET\n")])])]),s("p",[t._v("However, since those resources are "),s("strong",[t._v("protected")]),t._v(", you'll actually need\npermissions to mess with them. The permissions are available\nin "),s("code",[t._v("server_scope")]),t._v(" attribute of your app (and are visible in the dashboard)."),s("br"),t._v("\nThe only way for you to get the permissions is to\n"),s("a",{attrs:{href:"https://t.me/PlashikiSupport",target:"_blank",rel:"noopener noreferrer"}},[t._v("get in touch with us"),s("OutboundLink")],1),t._v(" and\ndescribe your use-case.")]),t._v(" "),s("p",[t._v("Some examples of protected actions:")]),t._v(" "),s("ul",[s("li",[t._v("Batch translation addition")]),t._v(" "),s("li",[t._v("Updating and receiving parsers' source code")]),t._v(" "),s("li",[t._v("Publishing notifications")]),t._v(" "),s("li",[t._v("and maybe more TBD....")])])])}),[],!1,null,null,null);e.default=n.exports}}]);